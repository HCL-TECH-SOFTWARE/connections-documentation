<html><head><title>Enable EE using OIDC OP as OAuth2 provider</title><meta http-equiv="Content-Type" content="text/html;charset=UTF-8" ><STYLE type="text/css">TABLE { border-collapse: collapse; border-top: 1px; border-left: 1px; border-style: solid; margin: 4px; }TD, TH { border-bottom: 1px; border-right: 1px; border-style: solid; padding: 4px; }TH { background-color: #D8D8D8; }</STYLE></head><body><div sandbox="allow-same-origin allow-scripts allow-popups"><p dir="ltr">This article describes how to properly setup the Connections Embedded Experience client at Keycloak.</p>

<p dir="ltr">&nbsp;</p>

<p dir="ltr">1. Register a client on Keycloak, my example is conn-ee-kc.</p>

<p dir="ltr"><img id="1584570589381_0" src="https://apps.na.collabserv.com/wikis/basic/api/wiki/68d8a7de-b173-4838-b5c9-a252a8fee125/page/b915fcfa-1963-429b-865a-db0ceccdad2b/attachment/18fc82ba-2c67-418d-b2af-100e29b688be/media/editor_image_629a154c-6ac9-4cae-8a0e-08a486ceef6c.png?preventCache=1590597086585"></img></p>

<p dir="ltr">Set the Redirect URI for each organization as follows, (For example):</p>

<p dir="ltr"><a href="https://connmt-orga.cnx.cwp.pnp-hcl.com/connections/opensocial/gadgets/oauth2callback">https://connmt-orga.cnx.cwp.pnp-hcl.com/connections/opensocial/gadgets/oauth2callback</a></p>

<p dir="ltr"><a href="https://connmt-orga.cnx.cwp.pnp-hcl.com/connections/opensocial/gadgets/oauth2callback">https://connmt-orgb.cnx.cwp.pnp-hcl.com/connections/opensocial/gadgets/oauth2callback</a></p>

<p dir="ltr">&nbsp;</p>

<p dir="ltr">2. Add a Keycloak Client Scope&nbsp;called Connections for your realm.</p>

<p dir="ltr"><img id="1590597301375_0" src="https://apps.na.collabserv.com/wikis/basic/api/wiki/68d8a7de-b173-4838-b5c9-a252a8fee125/page/b915fcfa-1963-429b-865a-db0ceccdad2b/attachment/3425a376-fea9-49d2-9825-836ba5aa2965/media/editor_image_2ac2e6f5-b2c5-4f8c-80fc-03d152e60d21.png" style="width: 400px; height: 200px;"></img></p>

<p dir="ltr">3. Associate the Connections scope as a default client scope for the Conn-ee-kc client</p>

<p dir="ltr"><img id="1590597476135_0" src="https://apps.na.collabserv.com/wikis/basic/api/wiki/68d8a7de-b173-4838-b5c9-a252a8fee125/page/b915fcfa-1963-429b-865a-db0ceccdad2b/attachment/06753e80-775a-43dd-ae35-5c7e90ff6828/media/editor_image_e537eb76-5073-4f7d-8442-b58285fb2f43.png" style="width: 600px; height: 250px;"></img></p>

<p dir="ltr">&nbsp;</p>

<p dir="ltr">4. (This step Should not be required if running the mtupdate scripts!) run the&nbsp; (note, replace client secret, keycloak auth and&nbsp;token endpoints with yours.</p>

<p dir="ltr"><a href="https://apps.na.collabserv.com/wikis/basic/api/wiki/68d8a7de-b173-4838-b5c9-a252a8fee125/page/b915fcfa-1963-429b-865a-db0ceccdad2b/attachment/50b4bafe-ca6a-471d-bb12-561fcdc08397/media/register_client_oidc_connmt.py" lconnwikiparamwikiattachment="register_client_oidc_connmt.py">register_client_oidc_connmt.py</a></p>

<p dir="ltr">&nbsp;</p>

<p dir="ltr">5. (This step Should not be required if running the mtupdate scripts!) create a&nbsp;proxy-policy.dynamic under&nbsp;LotusConnections-config/opensocial-proxy-rules directory&nbsp;</p>

<p dir="ltr">add&nbsp;</p>

<p dir="ltr">allow('.<b sandbox="allow-same-origin allow-scripts allow-popups">', '.</b>', 'https:\/\/lcauto3.cnx.cwp.pnp-hcl.com\/auth\/realms\/poolrealm\/protocol\/openid-connect\/token.*');</p>

<p dir="ltr">Note,</p>

<p dir="ltr">- change the realm name based on the env. for example, for "connmt" realm, change "poolrealm" to "connmt",&nbsp;</p>

<p dir="ltr">- change host to your keycloak host.</p></div></body></html>